# راهنمای تنظیمات توزیع شیفت‌های شب بر اساس سابقه

## مقدمه

این راهنما توضیح می‌دهد که چگونه از ویژگی جدید توزیع شیفت‌های شب باقی‌مانده بر اساس سابقه پرسنل استفاده کنید. این ویژگی به سوپروایزرها امکان تنظیم نحوه توزیع شیفت‌های شب اضافی را بر اساس سابقه و ترجیحات دپارتمان می‌دهد.

## نحوه عملکرد

### مراحل توزیع شیفت‌های شب

1. **تقسیم اولیه**: ابتدا حداقل تعداد شیفت شب مورد نیاز بین پرسنلی که شیفت شب دارند تقسیم می‌شود
2. **توزیع باقی‌مانده**: شیفت‌های شب باقی‌مانده بر اساس سابقه و تنظیمات دپارتمان توزیع می‌شود

### انواع توزیع بر اساس سابقه

#### 1. دپارتمان شب‌دوست (NightShiftDistributionType = 0)
- پرسنل با سابقه بیشتر اولویت دارند
- شیب نزولی: سابقه بیشتر = شیفت شب بیشتر
- مناسب برای دپارتمان‌هایی که شیفت شب را ترجیح می‌دهند

#### 2. دپارتمان شب‌گریز (NightShiftDistributionType = 1)
- پرسنل با سابقه کمتر اولویت دارند
- شیب صعودی: سابقه کمتر = شیفت شب بیشتر
- مناسب برای دپارتمان‌هایی که می‌خواهند بار شیفت شب را بر دوش پرسنل جدیدتر بیندازند

#### 3. خنثی (NightShiftDistributionType = 2)
- توزیع مساوی بدون در نظر گیری سابقه
- همه پرسنل به طور مساوی شیفت شب دریافت می‌کنند

## تنظیمات قابل پیکربندی

### فیلدهای اصلی

| فیلد | نوع | توضیح | مقدار پیش‌فرض |
|------|-----|-------|----------------|
| `EnableNightShiftDistributionBySeniority` | bool | فعال/غیرفعال کردن توزیع بر اساس سابقه | true |
| `NightShiftDistributionType` | int | نوع توزیع (0=شب‌دوست، 1=شب‌گریز، 2=خنثی) | 0 |
| `NightShiftDistributionWeight` | double | وزن توزیع در الگوریتم | 1.0 |
| `MinNightShiftsPerMonth` | int | حداقل شیفت شب ماهانه (فیلد موجود) | - |
| `SeniorityDistributionSlope` | double | شیب توزیع (کنترل شدت اولویت‌بندی) | 1.0 |

### تنظیم شیب توزیع

- **شیب = 1.0**: توزیع خطی بر اساس سابقه
- **شیب > 1.0**: اولویت‌بندی قوی‌تر (تفاوت بیشتر بین سابقه بالا و پایین)
- **شیب < 1.0**: اولویت‌بندی ملایم‌تر (تفاوت کمتر بین سابقه بالا و پایین)

## نحوه استفاده

### 1. تنظیم از طریق API

```http
PUT /api/DepartmentSchedulingSettings/night-shift-distribution/{id}
Content-Type: application/json

{
  "enableNightShiftDistributionBySeniority": true,
  "nightShiftDistributionType": 0,
  "nightShiftDistributionWeight": 1.5,
  "minNightShiftsPerMonth": 3,
  "seniorityDistributionSlope": 1.2
}
```

### 2. تنظیم از طریق رابط کاربری

1. وارد بخش تنظیمات دپارتمان شوید
2. بخش "تنظیمات توزیع شیفت‌های شب" را پیدا کنید
3. تنظیمات مورد نظر را انتخاب کنید
4. تغییرات را ذخیره کنید

## مثال‌های کاربردی

### مثال 1: دپارتمان شب‌دوست
```json
{
  "enableNightShiftDistributionBySeniority": true,
  "nightShiftDistributionType": 0,
  "nightShiftDistributionWeight": 2.0,
  "minNightShiftsPerMonth": 2,
  "seniorityDistributionSlope": 1.5
}
```
**نتیجه**: پرسنل با سابقه بیشتر شیفت شب بیشتری دریافت می‌کنند

### مثال 2: دپارتمان شب‌گریز
```json
{
  "enableNightShiftDistributionBySeniority": true,
  "nightShiftDistributionType": 1,
  "nightShiftDistributionWeight": 1.8,
  "minNightShiftsForNightShiftStaff": 1,
  "seniorityDistributionSlope": 1.3
}
```
**نتیجه**: پرسنل با سابقه کمتر شیفت شب بیشتری دریافت می‌کنند

### مثال 3: توزیع خنثی
```json
{
  "enableNightShiftDistributionBySeniority": false,
  "nightShiftDistributionType": 2,
  "nightShiftDistributionWeight": 0.0,
  "minNightShiftsPerMonth": 2,
  "seniorityDistributionSlope": 1.0
}
```
**نتیجه**: همه پرسنل به طور مساوی شیفت شب دریافت می‌کنند

## نکات مهم

### محاسبه سابقه
- سابقه بر اساس تاریخ استخدام محاسبه می‌شود
- حداکثر سابقه در نظر گرفته شده: 20 سال
- اگر تاریخ استخدام موجود نباشد، سابقه 0 در نظر گرفته می‌شود

### محدودیت‌ها
- تنظیمات فقط روی پرسنل شیفت شب اعمال می‌شود
- حداقل شیفت‌های مورد نیاز همیشه رعایت می‌شود
- محدودیت‌های ماهانه شیفت شب همچنان اعمال می‌شود

### توصیه‌ها
1. **وزن توزیع**: برای تأثیر بیشتر، مقدار 1.5 تا 2.0 توصیه می‌شود
2. **شیب توزیع**: برای توزیع متعادل، مقدار 1.0 تا 1.5 مناسب است
3. **حداقل شیفت**: بر اساس نیاز دپارتمان تنظیم کنید (معمولاً 1 تا 3)

## عیب‌یابی

### مشکلات رایج

1. **توزیع کار نمی‌کند**
   - بررسی کنید که `EnableNightShiftDistributionBySeniority` فعال باشد
   - اطمینان حاصل کنید که پرسنل شیفت شب در دپارتمان وجود دارد

2. **توزیع نامتعادل**
   - شیب توزیع را کاهش دهید
   - وزن توزیع را کم کنید

3. **توزیع بیش از حد**
   - شیب توزیع را افزایش دهید
   - وزن توزیع را زیاد کنید

## پشتیبانی

برای سوالات و مشکلات، با تیم پشتیبانی تماس بگیرید.
