# ุฑุงูููุง ูุงุฑุณ ูุญุงุณุจู ุณุงุนุช ููุธู ูุจุชู ุจุฑ ุขูโูุงูู ุจูุฑูโูุฑ

ุงู ูุณุชูุฏ ุชูุถุญ ูโุฏูุฏ ฺฉู ฺู ูุงุจูุชโูุง ุจู ุณุงูุงูู ุดูุชโุงุฑ ุงุถุงูู ุดุฏูุ ูุฑูููโูุง ูุญุงุณุจู ุณุงุนุช ููุธู ูพุฑุณูู ุจุงูู ุจุฑ ุงุณุงุณ ยซุขูโูุงูู ุงุฑุชูุง ุจูุฑูโูุฑ ฺฉุงุฑฺฉูุงู ุจุงููยป ฺฺฏููู ูพุงุฏูโุณุงุฒ ุดุฏู ู ฺุทูุฑ ูโุชูุงูุฏ ุงุฒ ุณุฑูุณ ุฌุฏุฏ ุงุณุชูุงุฏู ฺฉูุฏ.

---

## ฑ. ฺู ฺุฒ ุจู ูพุฑูฺู ุงุถุงูู ุดุฏุ

- **ูุฏูโูุง ุฏุงูููโุง ุจูุฑูโูุฑ** ุฏุฑ `ShiftYar.Domain/Entities/ProductivityModel/` ุดุงูู ุชูุธูุงุช ุขูโูุงูู (`ProductivityRuleConfig`) ู ุงุทูุงุนุงุช ุงุณุชุฎุฏุงู ูพุฑุณูู (`StaffEmploymentInfo`).
- **DTOโ ูุง ูุฑูุฏ ุฏุงุฏู** ุฏุฑ `ShiftYar.Application/DTOs/ProductivityModel/` ูุงููุฏ `StaffEmploymentInfoDto` ู `WorkingHoursCalculationRequestDto` ฺฉู ูุฑูุฏ/ุฎุฑูุฌ APIโูุง ู ุณุฑูุณโูุง ุฑุง ุงุฒ ูุงู ุฏุงููู ุฌุฏุง ูโฺฉูุฏ.
- **DTOูุง ูุญุงุณุจู** ุฏุฑ `ShiftYar.Application/DTOs/ProductivityModel/` ุจุฑุง ูุฑูุฏ ุฏุงุฏูุ ุฎุฑูุฌ ู ุฌุฒุฆุงุช ูุญุงุณุจู.
- **ูุงุณุท ุฌุฏุฏ** `IWorkingHoursCalculator` ุฏุฑ `ShiftYar.Application/Interfaces/ProductivityModel/` ฺฉู ูุงู Application ุฑุง ุงุฒ ูพุงุฏูโุณุงุฒ ุฌุฏุง ูโฺฉูุฏ.
- **ุณุฑูุณ ูุญุงุณุจุงุช** `WorkingHoursCalculator` ุฏุฑ `ShiftYar.Application/Features/ProductivityModel/Services/` ฺฉู ููุทู ุงุตู ุฑุง ูพุงุฏูโุณุงุฒ ูโฺฉูุฏ ู ุฏุฑ DI ุซุจุช ุดุฏู ุงุณุช.
- **ูุณุชูุฏ ุงูฺฏูุณ ฺฉูุชุงู** ุฏุฑ ูุณุฑ `ShiftYar.Application/Features/ProductivityModel/README.md` ู ุงู ูุณุชูุฏ ูุงุฑุณ (`README_FA.md`) ุจุฑุง ุชูุถุญุงุช ุชฺฉูู.

---

## ฒ. ููุทู ูุญุงุณุจู ุณุงุนุช ููุธู

ุทุจู ุขูโูุงููุ ุณุงุนุช ููุธู ููุชฺฏ ูพุงู ุจุฑุง ูุฑููุง ุจุงูู **ดด ุณุงุนุช** ุงุณุช. ุงู ููุฏุงุฑ ูโุชูุงูุฏ ุญุฏุงฺฉุซุฑ ุชุง **ธ ุณุงุนุช** ฺฉุงูุด ุงุจุฏ ู ฺฉุงูุดโูุง ุงุฒ ุณู ููุจุน ุชุดฺฉู ูโุดููุฏ:

1. **ุณุงุจูู ุฎุฏูุช (ุญุฏุงฺฉุซุฑ ต ุณุงุนุช)**  
   ููุงุฏุฑ ุฏูู ุฏุฑ ุฌุฏูู ุขูโูุงูู ูพุงุฏูโุณุงุฒ ุดุฏู (ุจุฎุด ุจุนุฏ).
2. **ุณุฎุช ฺฉุงุฑ (ุญุฏุงฺฉุซุฑ ฒ ุณุงุนุช)**  
   ุงฺฏุฑ ูพุฑุณูู ุฏุฑ ุจุฎุดโูุง ุฏุงุฑุง ุถุฑุจ ุณุฎุช ฺฉุงุฑ ุจุงุดุฏุ ฒ ุณุงุนุช ุงุฒ ููุธู ููุชฺฏ ฺฉุณุฑ ูโุดูุฏ.
3. **ุดูุชโูุง ุบุฑูุชุนุงุฑู/ฺุฑุฎุด (ุญุฏุงฺฉุซุฑ ฑ ุณุงุนุช)**  
   ุงฺฏุฑ ูุฑุฏ ุฏุฑ ุงูฺฏููุง ฺุฑุฎุด ุบุฑูุชุนุงุฑู (ุดุจ ู ุชุนุทู) ุจุงุดุฏุ ฑ ุณุงุนุช ุงุฒ ููุธู ฺฉู ูโุดูุฏ.

ููฺูู ุณุงุนุงุช ูุงูุน ฺฉุงุฑ ุฏุฑ **ุดุจ/ุชุนุทู** ุจุง ุถุฑุจ **ฑูซต** ูุญุงุณุจู ูโุดูุฏุ ุนู ูุฑ ุณุงุนุช ุดุจ ูุนุงุฏู ฑูซต ุณุงุนุช ููุธู ูุญุณูุจ ูโุดูุฏ ู ูุงุฒุงุฏ ฐูซต ุณุงุนุช ุจู ุนููุงู ยซุงุนุชุจุงุฑยป ุงุฒ ููุธู ูุงูุงูู ฺฉุณุฑ ูโฺฏุฑุฏุฏ.

---

## ณ. ูุฑูููโูุง ูุญุงุณุจู

- ูพุงู ููุชฺฏ: `BaseWeekly = 44`
- ูุฌููุน ฺฉุงูุด ููุชฺฏ:  
  `WeeklyReduction = min(8, Seniority + Hardship + Rotating)`
- ููุธู ููุชฺฏ ููุง:  
  `WeeklyRequired = max(0, BaseWeekly - WeeklyReduction)`
- ูพุงู ูุงูุงูู (ูุจู ุงุฒ ฺฉุงูุด):  
  `MonthlyBase = 44 ร NumberOfWeeks`
- ฺฉุงูุด ูุงูุงูู ูุงุด ุงุฒ ฺฉุณูุฑุงุช ููุชฺฏ:  
  `WeeklyDeductionsMonthly = WeeklyReduction ร NumberOfWeeks`
- ุงุนุชุจุงุฑ ุณุงุนุงุช ุดุจ/ุชุนุทู:  
  `NightHolidayCredit = (NightHours ร 1.5) - NightHours`
- ููุธู ูุงูุงูู ููุง:  
  `FinalMonthly = max(0, MonthlyBase - WeeklyDeductionsMonthly - NightHolidayCredit)`

ุฌุฏูู ฺฉุงูุด ุณุงุจูู:

| ุณุงุจูู (ุณุงู) | ฺฉุงูุด ููุชฺฏ |
|-------------|------------|
| 1 ุชุง 5      | 1 ุณุงุนุช     |
| 6 ุชุง 10     | 2 ุณุงุนุช     |
| 11 ุชุง 15    | 3 ุณุงุนุช     |
| 16 ุชุง 20    | 4 ุณุงุนุช     |
| ุจุด ุงุฒ 20   | 5 ุณุงุนุช     |

---

## ด. ูุงูโูุงุ ุณุฑูุณโูุง ู ูุฏูโูุง ุฌุฏุฏ

| ูุณุฑ | ุชูุถุญ |
|------|-------|
| `ShiftYar.Domain/Entities/ProductivityModel/ProductivityRuleConfig.cs` | ุชูุธูุงุช ุซุงุจุช ุขูโูุงูู (ดด ุณุงุนุชุ ุณูู ธ ุณุงุนุชุ ุถุฑุงุจ ู ุฌุฏูู ุณุงุจูู). |
| `ShiftYar.Domain/Entities/ProductivityModel/StaffEmploymentInfo.cs` | ุงุทูุงุนุงุช ุงุณุชุฎุฏุงู/ูพุฑููุฏู ูุฑ ูพุฑุณูู ุจุฑุง ูุญุงุณุจู (ุชุงุฑุฎ ุงุณุชุฎุฏุงูุ ุณุฎุช ฺฉุงุฑ ู ...). |
| `ShiftYar.Application/DTOs/ProductivityModel/WorkingHoursCalculationRequestDto.cs` | ูุฑูุฏ ุณุฑูุณ ุดุงูู ูุงู ูุฏูุ ุชุนุฏุงุฏ ููุชูุ ุณุงุนุงุช ุดุจ ู โฆ |
| `ShiftYar.Application/DTOs/ProductivityModel/WorkingHoursCalculationResultDto.cs` | ุฎุฑูุฌ ุชุฌูุน ุดุงูู ูพุงู ูุงูุงููุ ฺฉุณูุฑุงุช ู ููุธู ููุง. |
| `ShiftYar.Application/DTOs/ProductivityModel/WorkingHoursCalculationBreakdownDto.cs` | ุฌุฒุฆุงุช ฺฉุงูู ูุญุงุณุจู (ฺฉุงูุดโูุงุ ุถุฑุงุจุ ุงุฏุฏุงุดุชโูุง). |
| `ShiftYar.Application/Interfaces/ProductivityModel/IWorkingHoursCalculator.cs` | ูุงุณุท ุนููู ุณุฑูุณ ูุญุงุณุจู. |
| `ShiftYar.Application/Features/ProductivityModel/Services/WorkingHoursCalculator.cs` | ูพุงุฏูโุณุงุฒ ููุทู ูุญุงุณุจู. |
| `ShiftYar.Application/ApplicationDependencyInjection.cs` | ุซุจุช `IWorkingHoursCalculator` ุฏุฑ DI Container. |
| `ShiftYar.Application/Features/ProductivityModel/README.md` | ูุณุชูุฏ ุงูฺฏูุณ ฺฉูุชุงู. |
| `README_FA.md` | ุงู ูุณุชูุฏ ูุงุฑุณ. |

---

## ต. ูุญูู ุงุณุชูุงุฏู ู ููููู ูุฑุงุฎูุงู

1. **ุชุฒุฑู ูุงุจุณุชฺฏ**  
   ุฏุฑ ฺฉูุชุฑูุฑ ุง ุณุฑูุณ ุฎูุฏุ `IWorkingHoursCalculator` ุฑุง ุงุฒ ุทุฑู ุณุงุฒูุฏู ุฏุฑุงูุช ฺฉูุฏ. (ุฏุฑ DI ุซุจุช ุดุฏู ุงุณุช.)

2. **ุณุงุฎุช ุฏุฑุฎูุงุณุช ุจุฏูู ุชฺฉุฑุงุฑ ุฏุงุฏู**  
   ุจุง ุงุณุชูุงุฏู ุงุฒ `StaffEmploymentInfoDto` ุง ูุชุฏ `StaffEmploymentInfo.FromUser` ุงุทูุงุนุงุช ุฑุง ุขูุงุฏู ฺฉูุฏุ ุณูพุณ ุณุฑูุณ ุฑุง ุตุฏุง ุจุฒูุฏ:

```csharp
using ShiftYar.Application.DTOs.ProductivityModel;
using ShiftYar.Domain.Entities.ProductivityModel;
using ShiftYar.Domain.Entities.UserModel;

public class ProductivityFacade
{
    private readonly IWorkingHoursCalculator _calculator;

    public ProductivityFacade(IWorkingHoursCalculator calculator)
    {
        _calculator = calculator;
    }

    public WorkingHoursCalculationResultDto GetMonthlyHours(User user, DateTime month, decimal nightHours)
    {
        var staffInfo = new StaffEmploymentInfoDto
        {
            StaffId = user.Id ?? 0,
            StaffFullName = user.FullName,
            DateOfEmployment = user.DateOfEmployment,
            HasHardshipDuty = true,
            HasUncommonRotatingShifts = false
        };

        var request = new WorkingHoursCalculationRequestDto
        {
            TargetMonth = month,
            NumberOfWeeksInMonth = 4, // ุง ูุญุงุณุจู ูพูุง ุจุฑ ุงุณุงุณ ุชููู ูุงู
            NightHolidayHours = nightHours,
            Staff = staffInfo,
            RuleOverrides = new ProductivityRuleOverrideDto
            {
                // ุฏุฑ ุตูุฑุช ูุงุฒุ ููุงุฏุฑ ุฒุฑ ุฑุง override ฺฉูุฏ
                // BaseWeeklyHours = 42,
                // MaxWeeklyReduction = 7
            }
        };

        return _calculator.CalculateMonthlyHours(request);
    }
}
```

3. **ุฏุณุชุฑุณ ุจู ุฎุฑูุฌ**  
   - `BaseMonthlyHours`: ูพุงู ูุงูุงูู ูุจู ุงุฒ ฺฉุณูุฑุงุช  
   - `TotalDeductions`: ูุฌููุน ฺฉุณูุฑุงุช (ฺฉุงูุด ููุชฺฏ ร ููุชูโูุง + ุงุนุชุจุงุฑ ุดูุช ุดุจ/ุชุนุทู)  
   - `FinalMonthlyRequiredHours`: ููุธู ููุง  
   - `Breakdown`: ุฌุฒุฆุงุช ฺฉุงูู ุจุฑุง ฺฏุฒุงุฑุดโุฏู

---

## ถ. ูฺฉุงุช ูพฺฉุฑุจูุฏ ู ุชูุณุนู

- **ุชูุธูุงุช ุขูโูุงูู**: ุงฺฏุฑ ุฏุฑ ุขูุฏู ุงุนุฏุงุฏ ุขูโูุงูู ุชุบุฑ ฺฉุฑุฏุ ฺฉุงูโ ุงุณุช ููุงุฏุฑ `ProductivityRuleConfig` ุฑุง ุจูโุฑูุฒุฑุณุงู ุง ููููู ุฌุฏุฏ ุงุฒ ุขู ุฑุง ุจู `WorkingHoursCalculationRequestDto` ุชุฒุฑู ฺฉูุฏ.
- **ุชุนุฏุงุฏ ููุชูโูุง ูุงู**: ูุฑูุฏ `NumberOfWeeksInMonth` ุฑุง ูโุชูุงูุฏ ุจุง ุชูุฌู ุจู ุชููู ุดูุณ/ููุงุฏ ูุญุงุณุจู ู ุงุฑุณุงู ฺฉูุฏ. ููุฏุงุฑ ูพุดโูุฑุถ ูุฌูุฏ ูุฏุงุฑุฏ ู ุจุงุฏ ุฏุฑ ูุฑ ูุฑุงุฎูุงู ุชุนู ุดูุฏ.
- **ุงุทูุงุนุงุช ูพุฑุณูู**: ุจุง `StaffEmploymentInfo.FromUser(user, ...)` ูโุชูุงูุฏ ุฏุงุฏู ุฑุง ุจุฏูู ุชฺฉุฑุงุฑ ุงุฒ ููุฌูุฏุช `User` ุงุณุชุฎุฑุงุฌ ฺฉูุฏุ ุงฺฏุฑ ุณุงุจูู ุฎุฏูุช ุฑุง ูุจูุงู ูุญุงุณุจู ฺฉุฑุฏูโุงุฏุ ููุฏุงุฑ `YearsOfServiceOverride` ุฑุง ุณุช ฺฉูุฏ ุชุง ูุงุฒ ุจู ุชุงุฑุฎ ุงุณุชุฎุฏุงู ูุจุงุดุฏ.
- **ุงุทูุงุนุงุช ูพุฑุณูู**: ุงฺฏุฑ ุจู ุฏุงุฏูโูุง ุฎุงู ูุงุฒ ุฏุงุฑุฏ ุงุฒ `StaffEmploymentInfoDto` ุงุณุชูุงุฏู ฺฉูุฏ ู ุฏุฑ ุตูุฑุช ุฏุงุดุชู ุขุจุฌฺฉุช ุฏุงูููุ ููฺูุงู ูุชุฏ `StaffEmploymentInfo.FromUser` ูุงุจูโุงุณุชูุงุฏู ุงุณุชุ ูุฑ ุฏู ูุณุฑ ููุงุชุงู ุจู ูุฏู ุฏุงููู ุชุจุฏู ูโุดููุฏ.
- **Override ุชูุธูุงุช**: ุงฺฏุฑ ุจูุงุฑุณุชุงู ุณุงุณุช ูุชูุงูุช ุฏุงุฑุฏุ ุจูโุฌุง ุณุงุฎุช ูุณุชูู `ProductivityRuleConfig`ุ ุงุฒ `RuleOverrides` ุงุณุชูุงุฏู ฺฉูุฏ ุชุง ููุงุฏุฑ ุฏูุฎูุงู (ดด ุณุงุนุชุ ุณูู ธ ุณุงุนุชุ ุถุฑุงุจ ู ุฌุฏูู ุณุงุจูู) ุฑุง ููุท ุฏุฑ ููุงู ูุฑุงุฎูุงู ุชุบุฑ ุฏูุฏ.
- **ฺฏุณุชุฑุดุงุช ุขูุฏู**: ุฏุฑ ุตูุฑุช ูุงุฒ ูโุชูุงูุฏ ููุชโูุง ุงุฎุชุตุงุต ุง ููุงูู ุงูุฒูุฏู ุฑุง ุฏุฑ `WorkingHoursCalculationBreakdownDto.Notes` ุซุจุช ฺฉูุฏ ุชุง ุฏุฑ ุฎุฑูุฌ ฺฏุฒุงุฑุด ุดูุฏ.
- **ูพูุดุด ุฏุฑ ุงูฺฏูุฑุชูโูุง ุดูุชโุจูุฏ**: ฺฉุฏ ูุนู ุดูุชโุณุงุฒ ุฏุฑ ุณู ูุณุฑ (`SimulatedAnnealing`, `Hybrid`, `OrTools` ุฏุฑ ูุณุฑ `ShiftYar.Application/Features/ShiftModel/`) ูููุฒ ูุณุชููุงู ุงุฒ ุฎุฑูุฌ ุงู ุณุฑูุณ ุงุณุชูุงุฏู ููโฺฉูุฏ. ุจุฑุง ููุณุงูโุณุงุฒ ุจุงุฏ ุฏุฑ ูุฑุญูู ูพุดโูพุฑุฏุงุฒุด ุฏุงุฏูโ ูุฑูุฏ ุจู ูุฑ ุงูฺฏูุฑุชูุ ูุชุฌู `WorkingHoursCalculationResultDto` ุจู ุตูุฑุช Constraint ุง Penalty ุจู ฺฉูุงุณโูุง `SimulatedAnnealingScheduler`, `HybridScheduler` ู `OrToolsCPSatScheduler` ุชุฒุฑู ุดูุฏ.
- **ุฏูพูู**: ุชุบุฑ ุฏุฑ ุฏุชุงุจุณ ูุงุฒ ูุณุชุ ููุท ฺฉุฏูุง Application ู Domain ุจูโุฑูุฒุฑุณุงู ุดุฏูโุงูุฏ. ุจุนุฏ ุงุฒ Pull/Deployุ ูพุฑูฺู ุขูุงุฏู ุงุณุชูุงุฏู ุงุฒ ุณุฑูุณ ุฌุฏุฏ ุงุณุช.
- **ุชุณุช/Build**: ุงุฌุฑุง `dotnet build ShiftYar.sln` ุจุงุฏ ุจุฏูู ุฎุทุง ุจุงุดุฏ (ูุดุฏุงุฑูุง ูุจู ูพุฑูฺู ููฺูุงู ููฺฉู ุงุณุช ุฏุฏู ุดููุฏ).

---

ุจุฑุง ูุฑฺฏููู ุณุคุงู ุง ุชูุณุนู ุจุดุชุฑ (ูุซูุงู ุงุชุตุงู ุจู ฺฏุฒุงุฑุดโุณุงุฒุ ุฏุงุดุจูุฑุฏ ุง ูุญุงุณุจุงุช ุชุฑฺฉุจ ุจุง ุดูุชโุณุงุฒ)ุ ุงุฒ `WorkingHoursCalculator` ุจู ุนููุงู ููุทู ูุฑูุฏ ุงุณุชูุงุฏู ฺฉูุฏ ู ููุทู ุชฺฉูู ุฑุง ุฏุฑ ูุงู Application ุงุถุงูู ฺฉูุฏ. ูููู ุจุงุดุฏ! ๐ฏ

